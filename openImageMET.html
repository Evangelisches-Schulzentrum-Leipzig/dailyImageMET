<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Public Access Images - Metropolitan Museum of Art Collection</title>

        <!-- https://github.com/davidshimjs/qrcodejs -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>
    <body>
        <style>
            /* remove all default margin/padding */
            body, html {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
            #header {
                position: absolute;
                top: 1ex;
                right: 0;
                left: 0;
                text-align: center;
                color: white;
                font-family: sans-serif;
                font-size: 2em;
                font-weight: bold;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
                z-index: 1;
            }
            /* Container for fullscreen image and description/credits */
            #grid {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
            }
            /* Fullscreen Image */
            #grid #main-image {
                width: 100vw;
                height: 100vh;
                object-fit: contain;
            }
            /* Description/Credits */
            #footer {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                color: white;
                background: rgba(0, 0, 0, 0.5);
                padding: 10px;
                font-family: sans-serif;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: end;
            }
            #description {
                width: 100%;
                padding: 10px;
                font-family: sans-serif;
                display: flex;
                flex-direction: column;
                align-items: start;
            }
            #description span#title {
                font-size: 1.5em;
                font-weight: bold;
            }
            #description span#artist, #description span#date {
                font-size: 1.2em;
            }
            #credits-con {
                display: flex;
                flex-direction: row-reverse;
                align-items: end;
            }
            #credits {
                color: white; 
                text-decoration: none; 
                font-family: sans-serif;
                text-align: right;
            }
            #qrcode img {
                height: 100px;
                width: auto;
            }
            #bg-image {
                position: fixed;
                top: -10px;
                left: -10px;
                bottom: -10px;
                right: -10px;
                object-fit: cover;
                filter: blur(5px) brightness(0.7);
                z-index: -1;
                width: 110vw;
                height: 110vh;
            }
        </style>
        <div id="grid">
            <h1 id="header">Bild des Tages</h1>
            <div id="footer">
                <div id="description">
                    <span id="title"></span>
                    <span id="artist"></span>
                    <span id="date"></span>
                </div>
                <div id="credits-con">
                    <a id="credits" href="https://www.metmuseum.org/" target="_blank">&copy; Public Domain<br>The Metropolitan Museum of Art</a>
                    <div id="qrcode"></div>
                </div>
            </div>
        </div>
        <script>
            // API Query URL: "https://collectionapi.metmuseum.org/public/collection/v1/search?medium=Paintings&q=Landscapes&hasImages=true";
            // Query URL: "https://www.metmuseum.org/art/collection/search?showOnly=openAccess&material=Paintings&q=Landscape&sortBy=DateDesc"

            async function fetchImage(objectID) {
                let imageUrl = `https://collectionapi.metmuseum.org/public/collection/v1/objects/${objectID}`;
                try {
                    let response = await fetch(imageUrl);
                    let data = await response.json();
                    if (data.isPublicDomain && data.primaryImage) {
                        let imgElement = document.createElement('img');
                        imgElement.src = data.primaryImage;
                        imgElement.alt = data.title || 'Metropolitan Museum of Art Image';
                        imgElement.id = "main-image"
                        document.querySelector("#grid").appendChild(imgElement);
                        let bgImgElement = document.createElement('img');
                        bgImgElement.src = data.primaryImage;
                        bgImgElement.alt = 'Background Image';
                        bgImgElement.id = 'bg-image';
                        document.body.appendChild(bgImgElement);
                        document.getElementById('title').innerText = data.title || '';
                        document.getElementById('artist').innerText = data.artistDisplayName || '';
                        document.getElementById('date').innerText = data.objectDate || '';
                        new QRCode(document.querySelector("#qrcode"), {
                            text: data.objectURL,
                            correctLevel : QRCode.CorrectLevel.L
                        });
                    }
                    // console.log(data);
                } catch (error) {
                    console.error('Error fetching image:', error);
                }
            }
            //const urlParams = new URLSearchParams(window.location.search);
            //const ids = urlParams.get('ids').split(',');
            const ids = [11328,11316,11315,10767,436833,459095,11017,11771];

            // Compute daily image index based on current date
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const index = dayOfYear % ids.length;
            fetchImage(ids[index]);
        </script>
    </body>
</html>